// Database dei principali comuni del Lazio con coordinate geografiche
// Espanderemo questo database con tutti i 378 comuni

export const comuniLazio = {
  // PROVINCIA DI ROMA (121 comuni)
  'roma': {
    nome: 'Roma',
    provincia: 'Roma',
    sigla: 'RM',
    regione: 'Lazio',
    latitude: 41.9028,
    longitude: 12.4964,
    popolazione: 2844395,
    accuracy: 'high'
  },
  'albano_laziale': {
    nome: 'Albano Laziale',
    provincia: 'Roma',
    sigla: 'RM',
    regione: 'Lazio',
    latitude: 41.7289,
    longitude: 12.7581,
    popolazione: 38433,
    accuracy: 'high'
  },
  'tivoli': {
    nome: 'Tivoli',
    provincia: 'Roma',
    sigla: 'RM',
    regione: 'Lazio',
    latitude: 41.9630,
    longitude: 12.7973,
    popolazione: 56415,
    accuracy: 'high'
  },
  'guidonia_montecelio': {
    nome: 'Guidonia Montecelio',
    provincia: 'Roma',
    sigla: 'RM',
    regione: 'Lazio',
    latitude: 42.0180,
    longitude: 12.7241,
    popolazione: 88679,
    accuracy: 'high'
  },
  'anzio': {
    nome: 'Anzio',
    provincia: 'Roma',
    sigla: 'RM',
    regione: 'Lazio',
    latitude: 41.4484,
    longitude: 12.6231,
    popolazione: 53969,
    accuracy: 'high'
  },
  'civitavecchia': {
    nome: 'Civitavecchia',
    provincia: 'Roma',
    sigla: 'RM',
    regione: 'Lazio',
    latitude: 42.0956,
    longitude: 11.7957,
    popolazione: 51584,
    accuracy: 'high'
  },
  'velletri': {
    nome: 'Velletri',
    provincia: 'Roma',
    sigla: 'RM',
    regione: 'Lazio',
    latitude: 41.6878,
    longitude: 12.7783,
    popolazione: 52665,
    accuracy: 'high'
  },
  'frascati': {
    nome: 'Frascati',
    provincia: 'Roma',
    sigla: 'RM',
    regione: 'Lazio',
    latitude: 41.8081,
    longitude: 12.6803,
    popolazione: 21718,
    accuracy: 'high'
  },
  'marino': {
    nome: 'Marino',
    provincia: 'Roma',
    sigla: 'RM',
    regione: 'Lazio',
    latitude: 41.7761,
    longitude: 12.6641,
    popolazione: 37684,
    accuracy: 'high'
  },
  'genzano_di_roma': {
    nome: 'Genzano di Roma',
    provincia: 'Roma',
    sigla: 'RM',
    regione: 'Lazio',
    latitude: 41.7036,
    longitude: 12.6889,
    popolazione: 24150,
    accuracy: 'high'
  },
  'bracciano': {
    nome: 'Bracciano',
    provincia: 'Roma',
    sigla: 'RM',
    regione: 'Lazio',
    latitude: 42.1011,
    longitude: 12.1689,
    popolazione: 20128,
    accuracy: 'high'
  },
  'ariccia': {
    nome: 'Ariccia',
    provincia: 'Roma',
    sigla: 'RM',
    regione: 'Lazio',
    latitude: 41.7239,
    longitude: 12.6725,
    popolazione: 18403,
    accuracy: 'high'
  },
  'nettuno': {
    nome: 'Nettuno',
    provincia: 'Roma',
    sigla: 'RM',
    regione: 'Lazio',
    latitude: 41.4558,
    longitude: 12.6636,
    popolazione: 48516,
    accuracy: 'high'
  },

  // PROVINCIA DI LATINA (33 comuni)
  'latina': {
    nome: 'Latina',
    provincia: 'Latina',
    sigla: 'LT',
    regione: 'Lazio',
    latitude: 41.4677,
    longitude: 12.9037,
    popolazione: 127368,
    accuracy: 'high'
  },
  'aprilia': {
    nome: 'Aprilia',
    provincia: 'Latina',
    sigla: 'LT',
    regione: 'Lazio',
    latitude: 41.5919,
    longitude: 12.6428,
    popolazione: 73838,
    accuracy: 'high'
  },
  'terracina': {
    nome: 'Terracina',
    provincia: 'Latina',
    sigla: 'LT',
    regione: 'Lazio',
    latitude: 41.2906,
    longitude: 13.2436,
    popolazione: 44947,
    accuracy: 'high'
  },
  'formia': {
    nome: 'Formia',
    provincia: 'Latina',
    sigla: 'LT',
    regione: 'Lazio',
    latitude: 41.2564,
    longitude: 13.6061,
    popolazione: 37751,
    accuracy: 'high'
  },
  'gaeta': {
    nome: 'Gaeta',
    provincia: 'Latina',
    sigla: 'LT',
    regione: 'Lazio',
    latitude: 41.2136,
    longitude: 13.5681,
    popolazione: 20313,
    accuracy: 'high'
  },
  'sabaudia': {
    nome: 'Sabaudia',
    provincia: 'Latina',
    sigla: 'LT',
    regione: 'Lazio',
    latitude: 41.2969,
    longitude: 12.9272,
    popolazione: 20619,
    accuracy: 'high'
  },
  'fondi': {
    nome: 'Fondi',
    provincia: 'Latina',
    sigla: 'LT',
    regione: 'Lazio',
    latitude: 41.3564,
    longitude: 13.4228,
    popolazione: 39800,
    accuracy: 'high'
  },

  // PROVINCIA DI FROSINONE (91 comuni)
  'frosinone': {
    nome: 'Frosinone',
    provincia: 'Frosinone',
    sigla: 'FR',
    regione: 'Lazio',
    latitude: 41.6401,
    longitude: 13.3511,
    popolazione: 46286,
    accuracy: 'high'
  },
  'cassino': {
    nome: 'Cassino',
    provincia: 'Frosinone',
    sigla: 'FR',
    regione: 'Lazio',
    latitude: 41.4908,
    longitude: 13.8328,
    popolazione: 35900,
    accuracy: 'high'
  },
  'alatri': {
    nome: 'Alatri',
    provincia: 'Frosinone',
    sigla: 'FR',
    regione: 'Lazio',
    latitude: 41.7272,
    longitude: 13.3444,
    popolazione: 28609,
    accuracy: 'high'
  },
  'sora': {
    nome: 'Sora',
    provincia: 'Frosinone',
    sigla: 'FR',
    regione: 'Lazio',
    latitude: 41.7181,
    longitude: 13.6120,
    popolazione: 25674,
    accuracy: 'high'
  },
  'anagni': {
    nome: 'Anagni',
    provincia: 'Frosinone',
    sigla: 'FR',
    regione: 'Lazio',
    latitude: 41.7469,
    longitude: 13.1533,
    popolazione: 21424,
    accuracy: 'high'
  },
  'ferentino': {
    nome: 'Ferentino',
    provincia: 'Frosinone',
    sigla: 'FR',
    regione: 'Lazio',
    latitude: 41.6922,
    longitude: 13.2497,
    popolazione: 20261,
    accuracy: 'high'
  },

  // PROVINCIA DI VITERBO (60 comuni)
  'viterbo': {
    nome: 'Viterbo',
    provincia: 'Viterbo',
    sigla: 'VT',
    regione: 'Lazio',
    latitude: 42.4175,
    longitude: 12.1058,
    popolazione: 67846,
    accuracy: 'high'
  },
  'tarquinia': {
    nome: 'Tarquinia',
    provincia: 'Viterbo',
    sigla: 'VT',
    regione: 'Lazio',
    latitude: 42.2492,
    longitude: 11.7583,
    popolazione: 16286,
    accuracy: 'high'
  },
  'montefiascone': {
    nome: 'Montefiascone',
    provincia: 'Viterbo',
    sigla: 'VT',
    regione: 'Lazio',
    latitude: 42.5408,
    longitude: 12.0297,
    popolazione: 13444,
    accuracy: 'high'
  },
  'tuscania': {
    nome: 'Tuscania',
    provincia: 'Viterbo',
    sigla: 'VT',
    regione: 'Lazio',
    latitude: 42.4175,
    longitude: 11.8653,
    popolazione: 8390,
    accuracy: 'high'
  },
  'orte': {
    nome: 'Orte',
    provincia: 'Viterbo',
    sigla: 'VT',
    regione: 'Lazio',
    latitude: 42.4572,
    longitude: 12.3892,
    popolazione: 8939,
    accuracy: 'high'
  },

  // PROVINCIA DI RIETI (73 comuni)
  'rieti': {
    nome: 'Rieti',
    provincia: 'Rieti',
    sigla: 'RI',
    regione: 'Lazio',
    latitude: 42.4040,
    longitude: 12.8628,
    popolazione: 47700,
    accuracy: 'high'
  },
  'cittaducale': {
    nome: 'Cittaducale',
    provincia: 'Rieti',
    sigla: 'RI',
    regione: 'Lazio',
    latitude: 42.3822,
    longitude: 12.9440,
    popolazione: 6983,
    accuracy: 'high'
  },
  'fara_in_sabina': {
    nome: 'Fara in Sabina',
    provincia: 'Rieti',
    sigla: 'RI',
    regione: 'Lazio',
    latitude: 42.2181,
    longitude: 12.7211,
    popolazione: 13816,
    accuracy: 'high'
  }
};

// Funzione per normalizzare i nomi delle città
export function normalizeNome(nome) {
  return nome.toLowerCase()
    .replace(/[\s\-']/g, '_')
    .replace(/[àáâã]/g, 'a')
    .replace(/[èéêë]/g, 'e')
    .replace(/[ìíîï]/g, 'i')
    .replace(/[òóôõ]/g, 'o')
    .replace(/[ùúûü]/g, 'u');
}

// Funzione per cercare comuni
export function searchComuni(query) {
  const normalizedQuery = normalizeNome(query);
  const results = [];
  
  for (const [key, comune] of Object.entries(comuniLazio)) {
    const normalizedNome = normalizeNome(comune.nome);
    
    if (normalizedNome.includes(normalizedQuery) || normalizedQuery.includes(normalizedNome)) {
      results.push({
        name: comune.nome,
        province: comune.provincia,
        region: comune.regione,
        latitude: comune.latitude,
        longitude: comune.longitude,
        population: comune.popolazione,
        accuracy: comune.accuracy
      });
    }
  }
  
  return results;
}

// Funzione per reverse geocoding
export function reverseGeocode(lat, lng, threshold = 0.1) {
  let nearestComune = null;
  let minDistance = Infinity;
  
  for (const comune of Object.values(comuniLazio)) {
    const distance = Math.sqrt(
      Math.pow(lat - comune.latitude, 2) + 
      Math.pow(lng - comune.longitude, 2)
    );
    
    if (distance < minDistance) {
      minDistance = distance;
      nearestComune = comune;
    }
  }
  
  if (minDistance <= threshold && nearestComune) {
    return {
      name: nearestComune.nome,
      province: nearestComune.provincia,
      region: nearestComune.regione,
      latitude: nearestComune.latitude,
      longitude: nearestComune.longitude,
      population: nearestComune.popolazione,
      distance: minDistance
    };
  }
  
  return null;
}